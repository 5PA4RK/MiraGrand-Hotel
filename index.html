<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiraGrand-Hotel - Virtual Stay & Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Connection Modal (Login Required) -->
<div id="connectionModal" class="connection-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-hotel"></i> Welcome to MiraGrand-Hotel</h2>
        </div>
        <div class="modal-body">
            <!-- Mira Message Box (No Login Required) -->
<!-- Mira Message Box (No Login Required) -->
<div class="mira-message-section">
    <div class="mira-avatar">
        <i class="fas fa-user-tie"></i> <!-- Changed from fa-robot to fa-user-tie -->
    </div>
    <div class="mira-message-content">
        <h3>Message Mira <span class="mira-badge">Hotel Manager</span></h3> 
        <p>No login required - Send a message to the Hotel Manager</p>
        <div class="mira-input-group">
            <textarea id="miraMessageInput" class="form-input" placeholder="Type your message to Mira (Hotel Manager)... (No login needed)" rows="2"></textarea>
            <button id="sendMiraMessageBtn" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i> Send to Mira
            </button>
        </div>
        <div id="miraMessageSuccess" class="success-message" style="display: none;">
            <i class="fas fa-check-circle"></i> Message sent to Mira!
        </div>
    </div>
</div>

            <hr style="border-color: var(--border-color); margin: 25px 0;">

            <!-- Login Form -->
            <div class="connection-form">
                <h3><i class="fas fa-sign-in-alt"></i> Login to Your Account</h3>
                
                <div class="form-group">
                    <label for="usernameInput">
                        <i class="fas fa-user"></i> Username:
                    </label>
                    <input type="text" id="usernameInput" class="form-input" 
                           placeholder="Enter your username" autocomplete="off">
                </div>
                
                <div class="form-group">
                    <label for="passwordInput">
                        <i class="fas fa-lock"></i> Password:
                    </label>
                    <input type="password" id="passwordInput" class="form-input" 
                           placeholder="Enter your password">
                </div>
                
                <div id="passwordError" class="error-message" style="display: none;">
                    <i class="fas fa-exclamation-circle"></i>
                    <span></span>
                </div>
                
                <button id="connectBtn" class="btn btn-primary btn-large connect-button">
                    <i class="fas fa-plug"></i>
                    <span>Login to MiraGrand-Hotel</span>
                </button>
                
                <div class="connection-help">
                    <small>
                        <i class="fas fa-info-circle"></i>
                        Test accounts: guest/guest123, host/host123, mira/mira123
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Navigation Bar (Shown after login) -->
<header id="mainHeader" style="display: none;">
    <div class="container">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-hotel"></i>
                <h1>MiraGrand-Hotel</h1>
            </div>
            
            <div class="hotel-nav" id="hotelNav">
                <button class="nav-btn" data-panel="profile">
                    <i class="fas fa-user-circle"></i>
                    <span>My Profile</span>
                </button>
                <button class="nav-btn" data-panel="reception">
                    <i class="fas fa-concierge-bell"></i>
                    <span>Reception</span>
                </button>
                <button class="nav-btn" data-panel="hall">
                    <i class="fas fa-users"></i>
                    <span>The Hall</span>
                </button>
                <button class="nav-btn" data-panel="myroom">
                    <i class="fas fa-door-open"></i>
                    <span>My Room</span>
                </button>
            </div>
            
            <div class="header-controls">
                <div class="user-status">
                    <div id="statusIndicator" class="status-indicator offline"></div>
                    <span id="userRoleDisplay">Disconnected</span>
                </div>
                
                <!-- Mira Admin Panel Button (Only visible to Mira) -->
                <button id="adminPanelBtn" class="btn btn-secondary" style="display: none;">
                    <i class="fas fa-crown"></i> Admin
                </button>
                
                <button id="logoutBtn" class="btn btn-secondary" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </div>
</header>

<!-- Main Content Area - Panels -->
<div class="container main-content" id="mainContent" style="display: none;">
    
    <!-- MY PROFILE PANEL -->
    <div id="profilePanel" class="panel active-panel">
        <div class="panel-header">
            <h2><i class="fas fa-user-circle"></i> My Profile</h2>
        </div>
        <div class="panel-content">
            <div class="profile-avatar-section">
                <div class="profile-avatar" id="profileAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="avatar-upload">
                    <label for="profileImageUpload" class="btn btn-small">
                        <i class="fas fa-camera"></i> Upload Photo
                    </label>
                    <input type="file" id="profileImageUpload" accept="image/*" style="display: none;">
                </div>
            </div>
            
            <div class="profile-info">
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Username:</label>
                    <input type="text" id="profileUsername" class="form-input" readonly>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-id-card"></i> Display Name:</label>
                    <input type="text" id="profileDisplayName" class="form-input" placeholder="Enter display name">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-tag"></i> Role:</label>
                    <input type="text" id="profileRole" class="form-input" readonly>
                </div>
                
                <div class="profile-actions">
                    <button id="updateProfileBtn" class="btn btn-success">
                        <i class="fas fa-save"></i> Update Profile
                    </button>
                </div>
                
                <div id="profileUpdateMessage" class="success-message" style="display: none;"></div>
            </div>
        </div>
    </div>
    
    <!-- RECEPTION PANEL -->
    <div id="receptionPanel" class="panel">
        <div class="panel-header">
            <h2><i class="fas fa-concierge-bell"></i> Reception</h2>
            <div class="panel-actions">
                <button id="createRoomBtn" class="btn btn-success">
                    <i class="fas fa-plus-circle"></i> Create New Room
                </button>
            </div>
        </div>
        
        <div class="panel-content">
            <div class="reception-tabs">
                <button class="reception-tab active" data-tab="available">Available Rooms</button>
                <button class="reception-tab" data-tab="pending">Pending Requests</button>
            </div>
            
            <div id="availableRoomsTab" class="reception-tab-content active">
                <div class="rooms-grid" id="availableRoomsList">
                    <div class="loading-spinner"></div>
                    <p>Loading rooms...</p>
                </div>
            </div>
            
            <div id="pendingRequestsTab" class="reception-tab-content">
                <div class="pending-requests-list" id="pendingRequestsList">
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <p>No pending requests</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- THE HALL PANEL -->
    <div id="hallPanel" class="panel">
        <div class="panel-header">
            <h2><i class="fas fa-users"></i> The Hall</h2>
            <div class="hall-status">
                <span id="hallParticipantCount">0</span> participants
            </div>
        </div>
        
        <div class="hall-layout">
            <!-- Hall Chat -->
            <div class="hall-chat-section">
                <div class="hall-messages" id="hallMessages">
                    <div class="message received">
                        <div class="message-sender">Hall System</div>
                        <div class="message-content">
                            <div class="message-text">Welcome to The Hall! Everyone can chat here.</div>
                            <div class="message-time">Just now</div>
                        </div>
                    </div>
                </div>
                
                <div class="hall-participants-bar">
                    <span><i class="fas fa-users"></i> Participants:</span>
                    <span id="hallParticipantsList">Loading...</span>
                </div>
                
                <div class="hall-input-area">
                    <textarea id="hallMessageInput" class="message-input" placeholder="Type message to The Hall..."></textarea>
                    <button id="sendHallMessageBtn" class="btn">
                        <i class="fas fa-paper-plane"></i> Send
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MY ROOM PANEL -->
    <div id="myRoomPanel" class="panel">
        <div class="panel-header">
            <h2><i class="fas fa-door-open"></i> My Rooms</h2>
        </div>
        
        <div class="panel-content">
            <div class="my-rooms-list" id="myRoomsList">
                <!-- Rooms will be listed here -->
            </div>
            
            <!-- Room Chat Container (shown when room selected) -->
            <div id="roomChatContainer" style="display: none;">
                <div class="room-chat-header">
                    <button id="backToRoomsBtn" class="btn btn-small btn-secondary">
                        <i class="fas fa-arrow-left"></i> Back to Rooms
                    </button>
                    <h3 id="currentRoomTitle">Room Chat</h3>
                </div>
                
                <div class="chat-messages" id="roomMessages"></div>
                
                <div class="chat-input-area">
                    <textarea id="roomMessageInput" class="message-input" placeholder="Type your message..."></textarea>
                    <button id="sendRoomMessageBtn" class="btn">
                        <i class="fas fa-paper-plane"></i> Send
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ADMIN PANEL (Only visible to Mira) -->
    <div id="adminPanel" class="panel" style="display: none;">
        <div class="panel-header">
            <h2><i class="fas fa-crown"></i> Mira Admin Panel</h2>
        </div>
        
        <div class="admin-tabs">
            <button class="admin-tab active" data-tab="users">User Management</button>
            <button class="admin-tab" data-tab="rooms">Room Management</button>
            <button class="admin-tab" data-tab="messages">Messages to Mira</button>
        </div>
        
        <div id="adminUsersTab" class="admin-tab-content active">
            <div class="user-management-controls">
                <button id="addUserBtn" class="btn btn-success">
                    <i class="fas fa-user-plus"></i> Add User
                </button>
                <div class="search-box">
                    <input type="text" id="userSearchInput" placeholder="Search users...">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            <div class="users-list" id="adminUsersList"></div>
        </div>
        
        <div id="adminRoomsTab" class="admin-tab-content">
            <div class="rooms-list" id="adminRoomsList"></div>
        </div>
        
        <div id="adminMessagesTab" class="admin-tab-content">
            <div class="messages-to-mira" id="messagesToMiraList"></div>
        </div>
    </div>
</div>

<!-- Enhanced Admin Panel (Only visible to Mira) -->
<div id="miraAdminPanel" class="admin-panel" style="display: none;">
    <div class="admin-header">
        <h2><i class="fas fa-crown"></i> Mira Control Panel</h2>
        <div class="admin-status">
            <span class="admin-badge">Administrator</span>
        </div>
    </div>
    
    <div class="admin-tabs">
        <button class="admin-tab active" data-mira-tab="dashboard">
            <i class="fas fa-chart-line"></i> Dashboard
        </button>
        <button class="admin-tab" data-mira-tab="users">
            <i class="fas fa-users-cog"></i> User Management
        </button>
        <button class="admin-tab" data-mira-tab="rooms">
            <i class="fas fa-door-open"></i> Room Management
        </button>
        <button class="admin-tab" data-mira-tab="messages">
            <i class="fas fa-envelope"></i> Messages to Mira
        </button>
        <button class="admin-tab" data-mira-tab="analytics">
            <i class="fas fa-chart-bar"></i> Analytics
        </button>
    </div>
    
    <!-- Dashboard Tab -->
    <div id="miraDashboardTab" class="admin-tab-content active">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-details">
                    <span class="stat-value" id="totalUsersStat">0</span>
                    <span class="stat-label">Total Users</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-door-open"></i>
                </div>
                <div class="stat-details">
                    <span class="stat-value" id="totalRoomsStat">0</span>
                    <span class="stat-label">Active Rooms</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <div class="stat-details">
                    <span class="stat-value" id="totalMessagesStat">0</span>
                    <span class="stat-label">Total Messages</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-details">
                    <span class="stat-value" id="activeNowStat">0</span>
                    <span class="stat-label">Active Now</span>
                </div>
            </div>
        </div>
        
        <div class="recent-activity">
            <h3><i class="fas fa-history"></i> Recent Activity</h3>
            <div class="activity-list" id="recentActivityList">
                <div class="loading-spinner"></div>
            </div>
        </div>
    </div>
    
    <!-- User Management Tab -->
    <div id="miraUsersTab" class="admin-tab-content">
        <div class="admin-controls">
            <button id="miraAddUserBtn" class="btn btn-success">
                <i class="fas fa-user-plus"></i> Add New User
            </button>
            <div class="search-box">
                <input type="text" id="miraUserSearch" placeholder="Search users...">
                <i class="fas fa-search"></i>
            </div>
        </div>
        
        <div class="users-table-container">
            <table class="admin-table" id="usersTable">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Display Name</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Last Login</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <tr>
                        <td colspan="6" class="loading-row">Loading users...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Room Management Tab -->
    <div id="miraRoomsTab" class="admin-tab-content">
        <div class="admin-controls">
            <button id="refreshRoomsBtn" class="btn btn-secondary">
                <i class="fas fa-sync-alt"></i> Refresh
            </button>
            <div class="search-box">
                <input type="text" id="roomSearch" placeholder="Search rooms...">
                <i class="fas fa-search"></i>
            </div>
        </div>
        
        <div class="rooms-table-container">
            <table class="admin-table" id="roomsTable">
                <thead>
                    <tr>
                        <th>Room Name</th>
                        <th>Host</th>
                        <th>Guests</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="roomsTableBody">
                    <tr>
                        <td colspan="6" class="loading-row">Loading rooms...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Messages to Mira Tab -->
    <div id="miraMessagesTab" class="admin-tab-content">
        <div class="admin-controls">
            <button id="refreshMessagesBtn" class="btn btn-secondary">
                <i class="fas fa-sync-alt"></i> Refresh
            </button>
            <button id="markAllReadBtn" class="btn btn-success">
                <i class="fas fa-check-double"></i> Mark All Read
            </button>
        </div>
        
        <div class="messages-container" id="miraMessagesList">
            <div class="loading-spinner"></div>
        </div>
    </div>
    
    <!-- Analytics Tab -->
    <div id="miraAnalyticsTab" class="admin-tab-content">
        <div class="analytics-grid">
            <div class="analytics-card">
                <h4>User Roles Distribution</h4>
                <canvas id="userRolesChart" width="400" height="200"></canvas>
            </div>
            <div class="analytics-card">
                <h4>Room Activity</h4>
                <canvas id="roomActivityChart" width="400" height="200"></canvas>
            </div>
            <div class="analytics-card full-width">
                <h4>Daily Active Users</h4>
                <canvas id="dailyActiveChart" width="800" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Mira Add User Modal -->
<div id="miraAddUserModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-user-plus"></i> Add New User (Mira)</h2>
            <button class="btn btn-secondary btn-small close-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label><i class="fas fa-user"></i> Username:</label>
                <input type="text" id="miraNewUsername" class="form-input" placeholder="Enter username">
            </div>
            <div class="form-group">
                <label><i class="fas fa-id-card"></i> Display Name:</label>
                <input type="text" id="miraNewDisplayName" class="form-input" placeholder="Enter display name">
            </div>
            <div class="form-group">
                <label><i class="fas fa-lock"></i> Password:</label>
                <input type="password" id="miraNewPassword" class="form-input" placeholder="Enter password">
            </div>
            <div class="form-group">
                <label><i class="fas fa-tag"></i> Role:</label>
                <select id="miraNewRole" class="form-input">
                    <option value="guest">Guest</option>
                    <option value="host">Host</option>
                    <option value="admin">Admin</option>
                </select>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="miraNewActive" checked> Active Account
                </label>
            </div>
            <div id="miraAddUserError" class="error-message" style="display: none;"></div>
            <button id="miraSaveUserBtn" class="btn" style="width: 100%;">
                <i class="fas fa-save"></i> Create User
            </button>
        </div>
    </div>
</div>

<!-- Mira Edit User Modal -->
<div id="miraEditUserModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-user-edit"></i> Edit User</h2>
            <button class="btn btn-secondary btn-small close-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="miraEditUserId">
            <div class="form-group">
                <label><i class="fas fa-user"></i> Username:</label>
                <input type="text" id="miraEditUsername" class="form-input" readonly>
            </div>
            <div class="form-group">
                <label><i class="fas fa-id-card"></i> Display Name:</label>
                <input type="text" id="miraEditDisplayName" class="form-input">
            </div>
            <div class="form-group">
                <label><i class="fas fa-lock"></i> New Password (leave blank to keep current):</label>
                <input type="password" id="miraEditPassword" class="form-input" placeholder="Enter new password">
            </div>
            <div class="form-group">
                <label><i class="fas fa-tag"></i> Role:</label>
                <select id="miraEditRole" class="form-input">
                    <option value="guest">Guest</option>
                    <option value="host">Host</option>
                    <option value="admin">Admin</option>
                </select>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="miraEditActive"> Active Account
                </label>
            </div>
            <div id="miraEditUserError" class="error-message" style="display: none;"></div>
            <div class="modal-actions">
                <button id="miraUpdateUserBtn" class="btn" style="flex: 1;">
                    <i class="fas fa-save"></i> Update
                </button>
                <button id="miraDeleteUserBtn" class="btn btn-danger" style="flex: 1;">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
    </div>
</div>


<!-- Create Room Modal -->
<div id="createRoomModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-plus-circle"></i> Create New Room</h2>
            <button class="btn btn-secondary btn-small close-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="roomName"><i class="fas fa-tag"></i> Room Name:</label>
                <input type="text" id="roomName" class="form-input" placeholder="Enter room name">
            </div>
            
            <div class="form-group">
                <label for="roomDescription"><i class="fas fa-align-left"></i> Description (Optional):</label>
                <textarea id="roomDescription" class="form-input" rows="3" placeholder="Describe your room..."></textarea>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="roomRequireApproval" checked>
                    Require host approval for guests to join
                </label>
            </div>
            
            <div id="createRoomError" class="error-message" style="display: none;"></div>
            
            <button id="saveRoomBtn" class="btn" style="width: 100%;">
                <i class="fas fa-hotel"></i> Create Room
            </button>
        </div>
    </div>
</div>

<!-- Visit Room Request Modal -->
<div id="visitRoomModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-door-open"></i> Request to Visit Room</h2>
            <button class="btn btn-secondary btn-small close-modal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <p id="visitRoomInfo"></p>
            
            <div class="form-group">
                <label for="visitNote"><i class="fas fa-sticky-note"></i> Note to Host (Optional):</label>
                <textarea id="visitNote" class="form-input" rows="3" placeholder="Tell the host why you'd like to visit..."></textarea>
            </div>
            
            <div id="visitRoomError" class="error-message" style="display: none;"></div>
            
            <button id="sendVisitRequestBtn" class="btn" style="width: 100%;">
                <i class="fas fa-paper-plane"></i> Send Request
            </button>
        </div>
    </div>
</div>

<!-- Image Modal -->
<div id="imageModal" class="image-modal-overlay" style="display: none;">
    <div class="image-modal-content">
        <button class="close-image-modal">
            <i class="fas fa-times"></i>
        </button>
        <img id="fullSizeImage" src="" alt="Full size image">
    </div>
</div>

<footer>
    <div class="container">
        <p>MiraGrand-Hotel &copy; 2025 - Where Virtual Stays Become Real Conversations</p>
    </div>
</footer>

<!-- Scripts -->
<script src="app-core.js"></script>
<script src="app-chat.js"></script>
<script src="app-hotel.js"></script>
</body>
</html>
